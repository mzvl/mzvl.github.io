<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åšå®¢æ–‡ç« </title>

  <!-- æ ·å¼åº“ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.1.0/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />

  <style>
    html, body { margin: 0; padding: 0; font-family: sans-serif; overflow: hidden; }
    nav { position: fixed; top: 0; left: 0; height: 3rem; width: 100%; background: #fff; border-bottom: 1px solid #ddd; display: flex; align-items: center; padding: 0 1rem; z-index: 1000; }
    nav a { margin-right: 1.5rem; text-decoration: none; color: #000; display: flex; align-items: center; }
    nav span { margin-left: 0.3rem; }

    main { height: calc(100vh - 3rem); display: flex; overflow: hidden; }

    #toc, #archive { width: 15rem; padding: 1rem;margin-top:3rem; overflow-y: auto; background: #f9f9f9; box-sizing: border-box; }
    #archive { border-left: 1px solid #eee; }
    #toc { border-right: 1px solid #eee; }

    #content { flex: 1; padding: 2rem; margin-top:3rem;overflow-y: auto; box-sizing: border-box; word-wrap: break-word; }
    .markdown-body { max-width: 100%; }

    /* ä¸­å±å“åº”ï¼šéšè—å³æ å¹¶æ”¾åˆ°åº•éƒ¨ */
    @media (max-width: 1024px) {
      main { flex-direction: column; }
      #toc, #archive { width: 100%; }
      #archive { border-left: none; border-top: 1px solid #eee; }
      #toc { border-right: none; border-bottom: 1px solid #eee; }
    }

    /* å°å±å“åº”ï¼šå·¦æ ç›®å½•é»˜è®¤éšè—ï¼Œæ˜¾ç¤ºæŒ‰é’®æ§åˆ¶ */
    @media (max-width: 600px) {
      #toc { display: none; position: absolute; top: 3rem; left: 0; width: 100%; height: calc(100vh - 3rem); background: #fff; z-index: 999; }
      #show-toc-btn { display: block; position: fixed; top: 50%; left: 0.5rem; z-index: 1001; background: #007bff; color: white; padding: 0.4rem 0.6rem; border: none; border-radius: 0.3rem; }
    }

    #show-toc-btn { display: none; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">ğŸ <span>ä¸»é¡µ</span></a>
    <a href="blog.html">ğŸ“˜<span>åšå®¢</span></a>
    <a href="other.html">ğŸ“š<span>å…¶ä»–</span></a>
    <a href="about.html">ğŸ‘¤<span>å…³äº</span></a>
  </nav>

  <button id="show-toc-btn">ç›®å½•</button>

  <main>
    <div id="toc"></div>
    <div id="content" class="markdown-body">åŠ è½½ä¸­...</div>
    <div id="archive">
      <h3>å½’æ¡£</h3>
      <ul id="archive-list"></ul>
    </div>
  </main>

  <!-- æ’ä»¶å¼•å…¥ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/build/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  <script>
    const mdFile = new URLSearchParams(location.search).get('p') || 'readme.md';

    fetch('p/' + mdFile)
      .then(res => res.text())
      .then(text => {
        // æ¸²æŸ“ markdown -> HTML
        const html = marked.parse(text);
        document.getElementById('content').innerHTML = html;

        // æ¸²æŸ“ä»£ç é«˜äº®
        document.querySelectorAll('pre code').forEach(el => hljs.highlightAll(el));

        // æ¸²æŸ“æ•°å­¦å…¬å¼
        renderMathInElement(document.getElementById('content'), {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false }
          ]
        });

        // æ¸²æŸ“ Mermaid å›¾è¡¨
        mermaid.initialize({ startOnLoad: false });
        mermaid.run();

        // è‡ªåŠ¨æ„å»º TOCï¼ˆç®€å•å®ç°ï¼šæå– h1~h3ï¼‰
        const toc = document.getElementById('toc');
        const headers = document.querySelectorAll('#content h1, h2, h3');
        toc.innerHTML = '<h3>ç›®å½•</h3><ul>' +
          Array.from(headers).map(h => {
            const id = h.innerText.replace(/\s+/g, '-');
            h.id = id;
            return `<li style="margin-left:${(parseInt(h.tagName[1])-1)*1.2}rem"><a href="#${id}">${h.innerText}</a></li>`;
          }).join('') + '</ul>';

        // ç®€æ˜“å½’æ¡£ï¼ˆå¯æ¢æˆè¯»å– list.jsonï¼‰
        document.getElementById('archive-list').innerHTML =
          `<li><a href="?p=${mdFile}">${mdFile}</a></li>`;
      })
      .catch(err => {
        document.getElementById('content').innerText = 'åŠ è½½å¤±è´¥ï¼š' + err;
      });

    // ç§»åŠ¨ç«¯ï¼šæ˜¾ç¤ºç›®å½•æŒ‰é’® + ç‚¹å‡»ç©ºç™½å…³é—­
    const btn = document.getElementById('show-toc-btn');
    const tocBox = document.getElementById('toc');
    btn.onclick = () => tocBox.style.display = 'block';
    document.addEventListener('click', e => {
      if (window.innerWidth <= 600 && tocBox.style.display === 'block' && !tocBox.contains(e.target) && e.target !== btn) {
        tocBox.style.display = 'none';
      }
    });
  </script>
</body>
</html>
